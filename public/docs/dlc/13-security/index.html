<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Security Architecture - Smart Cooking App#
Security Overview#
Security Principles#

Defense in Depth: Multiple layers of security
Least Privilege: Minimum necessary permissions
Zero Trust: Verify everything, trust nothing
Encryption Everywhere: At rest and in transit
Security by Default: Secure configurations out of the box

Compliance &amp; Standards#
Standards:
  - OWASP Top 10 (Web Application Security)
  - AWS Well-Architected Framework (Security Pillar)
  - GDPR-Ready (EU data protection)

Certifications Target:
  - SOC 2 Type II (Post-MVP)
  - ISO 27001 (Future)Authentication &amp; Authorization#
1. Amazon Cognito User Pool#
Configuration#
User Pool Settings:
  Name: smart-cooking-users
  Sign-in Options:
    - Email
    - Username

  Password Policy:
    Minimum Length: 8 characters
    Require:
      - Lowercase letters
      - Uppercase letters
      - Numbers
      - Special characters (optional)
    Temporary Password: 24 hours expiry

  MFA (Multi-Factor Authentication):
    Status: Optional (MVP), Required (Premium - Future)
    Methods: SMS, TOTP

  Account Recovery:
    Methods: Email verification code

  Email Verification:
    Required: Yes
    Code Expiry: 24 hours

  User Attributes:
    Standard: email, name, birthdate, gender
    Custom:
      - country
      - preferred_cooking_methods
      - dietary_restrictionsJWT Token Structure#
Access Token (1 hour expiry):">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://example.org/docs/dlc/13-security/">
  <meta property="og:site_name" content="Together">
  <meta property="og:title" content="13 - Security">
  <meta property="og:description" content="Security Architecture - Smart Cooking App#Security Overview#Security Principles#Defense in Depth: Multiple layers of security Least Privilege: Minimum necessary permissions Zero Trust: Verify everything, trust nothing Encryption Everywhere: At rest and in transit Security by Default: Secure configurations out of the box Compliance &amp; Standards#Standards: - OWASP Top 10 (Web Application Security) - AWS Well-Architected Framework (Security Pillar) - GDPR-Ready (EU data protection) Certifications Target: - SOC 2 Type II (Post-MVP) - ISO 27001 (Future)Authentication &amp; Authorization#1. Amazon Cognito User Pool#Configuration#User Pool Settings: Name: smart-cooking-users Sign-in Options: - Email - Username Password Policy: Minimum Length: 8 characters Require: - Lowercase letters - Uppercase letters - Numbers - Special characters (optional) Temporary Password: 24 hours expiry MFA (Multi-Factor Authentication): Status: Optional (MVP), Required (Premium - Future) Methods: SMS, TOTP Account Recovery: Methods: Email verification code Email Verification: Required: Yes Code Expiry: 24 hours User Attributes: Standard: email, name, birthdate, gender Custom: - country - preferred_cooking_methods - dietary_restrictionsJWT Token Structure#Access Token (1 hour expiry):">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
<title>13 - Security | Together</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="https://example.org/docs/dlc/13-security/">
<link rel="stylesheet" href="/book.min.d124d6c76b11546b04023ef152f0ca77dd5bfd00e1638c75250d60e274cdc189.css" integrity="sha256-0STWx2sRVGsEAj7xUvDKd91b/QDhY4x1JQ1g4nTNwYk=" crossorigin="anonymous">


  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.a12a0edc5979b40b3a21762e87b6bf03e2526b9cde0291a4eb1be5a9403b30b3.js" integrity="sha256-oSoO3Fl5tAs6IXYuh7a/A&#43;JSa5zeApGk6xvlqUA7MLM=" crossorigin="anonymous"></script>

  
</head>
<body dir="ltr" class="book-kind-page book-type-docs">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Together</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>














  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/summary/" class="">
      Summary</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/summary/aws-services-diagram/" class="">
      AWS Services Architecture Diagram</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/summary/ai-agent-implementation/" class="">
      K·∫ø Ho·∫°ch Tri·ªÉn Khai AI Agent</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/summary/database-diagram/" class="">
      Database Schema Diagram</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/summary/cost-analysis/" class="">
      Ph√¢n T√≠ch Chi Ph√≠</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/" class="">
      AI DLC</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/00-overview/" class="">
      00 - Project Overview</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/01-requirements/" class="">
      01 - Requirements</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/02-constraints/" class="">
      02 - Constraints</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/10-architecture/" class="">
      10 - Architecture</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/11-database/" class="">
      11 - Database Design</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/12-api-spec/" class="">
      12 - API Specification</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/13-security/" class="active">
      13 - Security</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/14-ai-agent/" class="">
      14 - AI Agent Design</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/20-backend/" class="">
      20 - Backend Implementation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/21-frontend/" class="">
      21 - Frontend Implementation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/22-devops/" class="">
      22 - DevOps &amp; Deployment</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/23-tasks/" class="">
      23 - Implementation Tasks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/30-cost-analysis/" class="">
      30 - Cost Analysis</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/31-scaling/" class="">
      31 - Scaling Strategy</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/32-monitoring/" class="">
      32 - Monitoring &amp; Observability</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/40-auth/" class="">
      40 - Authentication &amp; Authorization</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/41-privacy/" class="">
      41 - Privacy &amp; Data Protection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/42-compliance/" class="">
      42 - Compliance &amp; Governance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/99-glossary/" class="">
      99 - Glossary</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dlc/99-references/" class="">
      99 - References</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>













</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header hidden">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/icons/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>13 - Security</h3>

  <label for="toc-control">
    
    <img src="/icons/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#security-overview">Security Overview</a>
      <ul>
        <li><a href="#security-principles">Security Principles</a></li>
        <li><a href="#compliance--standards">Compliance &amp; Standards</a></li>
      </ul>
    </li>
    <li><a href="#authentication--authorization">Authentication &amp; Authorization</a>
      <ul>
        <li><a href="#1-amazon-cognito-user-pool">1. Amazon Cognito User Pool</a></li>
        <li><a href="#2-api-gateway-authorization">2. API Gateway Authorization</a></li>
        <li><a href="#3-lambda-authorization">3. Lambda Authorization</a></li>
      </ul>
    </li>
    <li><a href="#aws-waf-web-application-firewall">AWS WAF (Web Application Firewall)</a>
      <ul>
        <li><a href="#waf-rules-configuration">WAF Rules Configuration</a></li>
        <li><a href="#rate-limiting-strategy">Rate Limiting Strategy</a></li>
      </ul>
    </li>
    <li><a href="#data-encryption">Data Encryption</a>
      <ul>
        <li><a href="#1-encryption-at-rest">1. Encryption at Rest</a></li>
        <li><a href="#2-encryption-in-transit">2. Encryption in Transit</a></li>
        <li><a href="#3-secrets-management">3. Secrets Management</a></li>
      </ul>
    </li>
    <li><a href="#iam-identity-and-access-management">IAM (Identity and Access Management)</a>
      <ul>
        <li><a href="#lambda-execution-roles">Lambda Execution Roles</a></li>
        <li><a href="#s3-bucket-policies">S3 Bucket Policies</a></li>
      </ul>
    </li>
    <li><a href="#security-monitoring--incident-response">Security Monitoring &amp; Incident Response</a>
      <ul>
        <li><a href="#cloudwatch-alarms">CloudWatch Alarms</a></li>
        <li><a href="#aws-x-ray-tracing">AWS X-Ray Tracing</a></li>
        <li><a href="#logging-strategy">Logging Strategy</a></li>
      </ul>
    </li>
    <li><a href="#-vulnerability-management">üîç Vulnerability Management</a>
      <ul>
        <li><a href="#owasp-top-10-mitigations">OWASP Top 10 Mitigations</a></li>
      </ul>
    </li>
    <li><a href="#api-security-best-practices">API Security Best Practices</a>
      <ul>
        <li><a href="#request-validation">Request Validation</a></li>
        <li><a href="#cors-configuration">CORS Configuration</a></li>
        <li><a href="#security-headers">Security Headers</a></li>
      </ul>
    </li>
    <li><a href="#privacy--data-protection">Privacy &amp; Data Protection</a>
      <ul>
        <li><a href="#gdpr-compliance">GDPR Compliance</a></li>
        <li><a href="#ai-privacy-policy">AI Privacy Policy</a></li>
      </ul>
    </li>
    <li><a href="#related-documents">Related Documents</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="security-architecture---smart-cooking-app">Security Architecture - Smart Cooking App<a class="anchor" href="#security-architecture---smart-cooking-app">#</a></h1>
<h2 id="security-overview">Security Overview<a class="anchor" href="#security-overview">#</a></h2>
<h3 id="security-principles">Security Principles<a class="anchor" href="#security-principles">#</a></h3>
<ol>
<li><strong>Defense in Depth</strong>: Multiple layers of security</li>
<li><strong>Least Privilege</strong>: Minimum necessary permissions</li>
<li><strong>Zero Trust</strong>: Verify everything, trust nothing</li>
<li><strong>Encryption Everywhere</strong>: At rest and in transit</li>
<li><strong>Security by Default</strong>: Secure configurations out of the box</li>
</ol>
<h3 id="compliance--standards">Compliance &amp; Standards<a class="anchor" href="#compliance--standards">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Standards</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">OWASP Top 10 (Web Application Security)</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">AWS Well-Architected Framework (Security Pillar)</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">GDPR-Ready (EU data protection)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Certifications Target</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">SOC 2 Type II (Post-MVP)</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">ISO 27001 (Future)</span></span></span></code></pre></div><h2 id="authentication--authorization">Authentication &amp; Authorization<a class="anchor" href="#authentication--authorization">#</a></h2>
<h3 id="1-amazon-cognito-user-pool">1. Amazon Cognito User Pool<a class="anchor" href="#1-amazon-cognito-user-pool">#</a></h3>
<h4 id="configuration">Configuration<a class="anchor" href="#configuration">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">User Pool Settings</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Name</span>: <span style="color:#ae81ff">smart-cooking-users</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Sign-in Options</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">Email</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">Username</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Password Policy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Minimum Length</span>: <span style="color:#ae81ff">8</span> <span style="color:#ae81ff">characters</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Require</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">Lowercase letters</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">Uppercase letters</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">Numbers</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">Special characters (optional)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Temporary Password</span>: <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">hours expiry</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">MFA (Multi-Factor Authentication)</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Status</span>: <span style="color:#ae81ff">Optional (MVP), Required (Premium - Future)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Methods</span>: <span style="color:#ae81ff">SMS, TOTP</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Account Recovery</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Methods</span>: <span style="color:#ae81ff">Email verification code</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Email Verification</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Required</span>: <span style="color:#66d9ef">Yes</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Code Expiry</span>: <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">hours</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">User Attributes</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Standard</span>: <span style="color:#ae81ff">email, name, birthdate, gender</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Custom</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">country</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">preferred_cooking_methods</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">dietary_restrictions</span></span></span></code></pre></div><h4 id="jwt-token-structure">JWT Token Structure<a class="anchor" href="#jwt-token-structure">#</a></h4>
<p><strong>Access Token</strong> (1 hour expiry):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;sub&#34;</span>: <span style="color:#e6db74">&#34;uuid-123&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;cognito:username&#34;</span>: <span style="color:#e6db74">&#34;cookmaster&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;email&#34;</span>: <span style="color:#e6db74">&#34;user@example.com&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;email_verified&#34;</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;iss&#34;</span>: <span style="color:#e6db74">&#34;https://cognito-idp.us-east-1.amazonaws.com/...&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;client_id&#34;</span>: <span style="color:#e6db74">&#34;abc123...&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;token_use&#34;</span>: <span style="color:#e6db74">&#34;access&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;scope&#34;</span>: <span style="color:#e6db74">&#34;aws.cognito.signin.user.admin&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;auth_time&#34;</span>: <span style="color:#ae81ff">1706097600</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;exp&#34;</span>: <span style="color:#ae81ff">1706101200</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;iat&#34;</span>: <span style="color:#ae81ff">1706097600</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><strong>ID Token</strong> (1 hour expiry):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;sub&#34;</span>: <span style="color:#e6db74">&#34;uuid-123&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;cognito:username&#34;</span>: <span style="color:#e6db74">&#34;cookmaster&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;email&#34;</span>: <span style="color:#e6db74">&#34;user@example.com&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;custom:role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;custom:country&#34;</span>: <span style="color:#e6db74">&#34;Vietnam&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;iss&#34;</span>: <span style="color:#e6db74">&#34;https://cognito-idp.us-east-1.amazonaws.com/...&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;aud&#34;</span>: <span style="color:#e6db74">&#34;abc123...&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;token_use&#34;</span>: <span style="color:#e6db74">&#34;id&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;auth_time&#34;</span>: <span style="color:#ae81ff">1706097600</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;exp&#34;</span>: <span style="color:#ae81ff">1706101200</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;iat&#34;</span>: <span style="color:#ae81ff">1706097600</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p><strong>Refresh Token</strong> (30 days expiry):</p>
<ul>
<li>Used to get new Access/ID tokens</li>
<li>Stored securely in httpOnly cookie (not localStorage)</li>
<li>Rotated on each use</li>
</ul>
<h3 id="2-api-gateway-authorization">2. API Gateway Authorization<a class="anchor" href="#2-api-gateway-authorization">#</a></h3>
<h4 id="cognito-authorizer-configuration">Cognito Authorizer Configuration<a class="anchor" href="#cognito-authorizer-configuration">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Authorizer Type</span>: <span style="color:#ae81ff">COGNITO_USER_POOLS</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">User Pool</span>: <span style="color:#ae81ff">smart-cooking-users</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Token Source</span>: <span style="color:#ae81ff">Authorization header</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Token Validation</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Signature verification</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Expiration check</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Issuer validation</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Authorization Caching</span>: <span style="color:#ae81ff">300</span> <span style="color:#ae81ff">seconds (5 minutes)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Identity Source</span>: <span style="color:#ae81ff">method.request.header.Authorization</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Unauthorized Response</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Status</span>: <span style="color:#ae81ff">401</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Body</span>: { <span style="color:#f92672">&#34;message&#34;: </span><span style="color:#e6db74">&#34;Unauthorized&#34;</span> }</span></span></code></pre></div><h4 id="request-validation-flow">Request Validation Flow<a class="anchor" href="#request-validation-flow">#</a></h4>
<pre class="mermaid">sequenceDiagram
    participant Client
    participant APIGateway
    participant Cognito
    participant Lambda
    participant DynamoDB

    Client-&gt;&gt;APIGateway: Request + JWT Token
    APIGateway-&gt;&gt;APIGateway: Validate request schema
    APIGateway-&gt;&gt;Cognito: Verify JWT signature
    Cognito--&gt;&gt;APIGateway: Token valid + claims
    APIGateway-&gt;&gt;APIGateway: Check authorization cache

    alt Token valid &amp; cached
        APIGateway-&gt;&gt;Lambda: Invoke with context
    else Token invalid
        APIGateway--&gt;&gt;Client: 401 Unauthorized
    end

    Lambda-&gt;&gt;Lambda: Extract user_id from context
    Lambda-&gt;&gt;DynamoDB: Query with user_id
    Lambda-&gt;&gt;Lambda: Check permissions (role, ownership)

    alt Has permission
        Lambda--&gt;&gt;APIGateway: Success response
    else No permission
        Lambda--&gt;&gt;APIGateway: 403 Forbidden
    end

    APIGateway--&gt;&gt;Client: Response</pre><script src="/mermaid.min.js"></script><script>mermaid.initialize({"flowchart":{"useMaxWidth":true},"theme":"default"})</script><h3 id="3-lambda-authorization">3. Lambda Authorization<a class="anchor" href="#3-lambda-authorization">#</a></h3>
<h4 id="context-extraction">Context Extraction<a class="anchor" href="#context-extraction">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// Lambda receives Cognito context from API Gateway
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">exports</span>.<span style="color:#a6e22e">handler</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">event</span>, <span style="color:#a6e22e">context</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Extract user identity from Cognito authorizer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">claims</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">requestContext</span>.<span style="color:#a6e22e">authorizer</span>.<span style="color:#a6e22e">claims</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">userId</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">claims</span>.<span style="color:#a6e22e">sub</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">username</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">claims</span>[<span style="color:#e6db74">&#39;cognito:username&#39;</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">email</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">claims</span>.<span style="color:#a6e22e">email</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">role</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">claims</span>[<span style="color:#e6db74">&#39;custom:role&#39;</span>] <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39;user&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Authorization checks
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">isUserActive</span>(<span style="color:#a6e22e">userId</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">statusCode</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">403</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">body</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;account_inactive&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">message</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Your account has been deactivated&#39;</span>
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Resource ownership check
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">requestedUserId</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">userId</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">role</span> <span style="color:#f92672">!==</span> <span style="color:#e6db74">&#39;admin&#39;</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">statusCode</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">403</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">body</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>({
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;forbidden&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">message</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;You do not have permission to access this resource&#39;</span>
</span></span><span style="display:flex;"><span>      })
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Proceed with business logic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};</span></span></code></pre></div><h4 id="role-based-access-control-rbac">Role-Based Access Control (RBAC)<a class="anchor" href="#role-based-access-control-rbac">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">PERMISSIONS</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">user</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;read:own_profile&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;write:own_profile&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;read:own_ingredients&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;write:own_ingredients&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;read:public_recipes&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;write:own_recipes&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;read:ai_suggestions&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;write:ai_suggestions&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;read:own_cooking_history&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;write:own_cooking_history&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;write:recipe_ratings&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;read:friends&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;write:friends&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;read:own_posts&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;write:own_posts&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;write:comments&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;write:reactions&#39;</span>
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">admin</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;*&#39;</span>, <span style="color:#75715e">// All permissions
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#e6db74">&#39;read:all_users&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;write:user_status&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;read:all_recipes&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;write:recipe_approval&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;read:statistics&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;read:invalid_reports&#39;</span>
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">hasPermission</span>(<span style="color:#a6e22e">role</span>, <span style="color:#a6e22e">permission</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rolePermissions</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">PERMISSIONS</span>[<span style="color:#a6e22e">role</span>] <span style="color:#f92672">||</span> [];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">rolePermissions</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#39;*&#39;</span>) <span style="color:#f92672">||</span>
</span></span><span style="display:flex;"><span>         <span style="color:#a6e22e">rolePermissions</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">permission</span>);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><h2 id="aws-waf-web-application-firewall">AWS WAF (Web Application Firewall)<a class="anchor" href="#aws-waf-web-application-firewall">#</a></h2>
<h3 id="waf-rules-configuration">WAF Rules Configuration<a class="anchor" href="#waf-rules-configuration">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">WAF WebACL</span>: <span style="color:#ae81ff">smart-cooking-waf</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Scope</span>: <span style="color:#ae81ff">REGIONAL (API Gateway)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Default Action</span>: <span style="color:#ae81ff">ALLOW</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Managed Rule Groups</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">AWSManagedRulesCommonRuleSet</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Priority</span>: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Excludes</span>: []
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Protects against:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># - SQL injection</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># - XSS (Cross-Site Scripting)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># - Path traversal</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># - Command injection</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">AWSManagedRulesKnownBadInputsRuleSet</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Priority</span>: <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Blocks malicious request patterns</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Custom Rules</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">RateLimitRule</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Priority</span>: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Type</span>: <span style="color:#ae81ff">RATE_BASED</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Limit</span>: <span style="color:#ae81ff">1000</span> <span style="color:#ae81ff">requests per 5 minutes per IP</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Action</span>: <span style="color:#ae81ff">BLOCK</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Scope</span>: <span style="color:#ae81ff">IP</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">GeoBlockRule</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Priority</span>: <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Type</span>: <span style="color:#ae81ff">GEO_MATCH</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Countries</span>: [] <span style="color:#75715e"># No blocking in MVP</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Action: BLOCK # Future</span>: <span style="color:#ae81ff">Block high-risk countries</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">APIEndpointProtection</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Priority</span>: <span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Type</span>: <span style="color:#ae81ff">REGEX_PATTERN_SET</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Patterns</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">/admin/* (Require admin token)</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">/ai/suggest (Rate limit</span>: <span style="color:#ae81ff">100</span><span style="color:#ae81ff">/hour/user)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Action</span>: <span style="color:#ae81ff">CUSTOM_RESPONSE</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Logging</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Enabled</span>: <span style="color:#66d9ef">Yes</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Destination</span>: <span style="color:#ae81ff">CloudWatch Logs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">LogGroup</span>: <span style="color:#ae81ff">/aws/waf/smart-cooking</span></span></span></code></pre></div><h3 id="rate-limiting-strategy">Rate Limiting Strategy<a class="anchor" href="#rate-limiting-strategy">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Tiers</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Global</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Requests</span>: <span style="color:#ae81ff">1000</span> <span style="color:#ae81ff">per 5 minutes per IP</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Action</span>: <span style="color:#ae81ff">Block for 10 minutes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Free User</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">AI Suggestions</span>: <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">per month</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">API Requests</span>: <span style="color:#ae81ff">1000</span> <span style="color:#ae81ff">per hour</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Action</span>: <span style="color:#ae81ff">429</span> <span style="color:#ae81ff">Too Many Requests</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Premium User</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">AI Suggestions</span>: <span style="color:#ae81ff">Unlimited</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">API Requests</span>: <span style="color:#ae81ff">10000</span> <span style="color:#ae81ff">per hour</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Action</span>: <span style="color:#ae81ff">429</span> <span style="color:#ae81ff">(soft limit, can burst)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Admin</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">No</span> <span style="color:#ae81ff">limits</span></span></span></code></pre></div><h2 id="data-encryption">Data Encryption<a class="anchor" href="#data-encryption">#</a></h2>
<h3 id="1-encryption-at-rest">1. Encryption at Rest<a class="anchor" href="#1-encryption-at-rest">#</a></h3>
<h4 id="dynamodb-encryption">DynamoDB Encryption<a class="anchor" href="#dynamodb-encryption">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Encryption</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Type</span>: <span style="color:#ae81ff">AWS Managed Keys (AWS KMS)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Key</span>: <span style="color:#ae81ff">aws/dynamodb</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Algorithm</span>: <span style="color:#ae81ff">AES-256</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Scope</span>: <span style="color:#ae81ff">All tables and indexes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Point-in-Time Recovery (PITR)</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Enabled</span>: <span style="color:#66d9ef">Yes</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Encrypted</span>: <span style="color:#66d9ef">Yes</span> <span style="color:#ae81ff">(same key)</span></span></span></code></pre></div><h4 id="s3-encryption">S3 Encryption<a class="anchor" href="#s3-encryption">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Buckets</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">smart-cooking-recipe-images-prod</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">smart-cooking-user-avatars-prod</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">smart-cooking-post-images-prod</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Encryption</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Type</span>: <span style="color:#ae81ff">SSE-S3 (Server-Side Encryption with S3 managed keys)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Algorithm</span>: <span style="color:#ae81ff">AES-256</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Bucket Policies</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Deny unencrypted uploads</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Require HTTPS</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Versioning</span>: <span style="color:#ae81ff">Enabled (critical buckets)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">MFA Delete</span>: <span style="color:#ae81ff">Enabled (production)</span></span></span></code></pre></div><h4 id="cloudwatch-logs-encryption">CloudWatch Logs Encryption<a class="anchor" href="#cloudwatch-logs-encryption">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Encryption</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Type</span>: <span style="color:#ae81ff">AWS KMS</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Key</span>: <span style="color:#ae81ff">aws/logs</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">All log groups</span>: <span style="color:#ae81ff">Encrypted by default</span></span></span></code></pre></div><h3 id="2-encryption-in-transit">2. Encryption in Transit<a class="anchor" href="#2-encryption-in-transit">#</a></h3>
<h4 id="https-enforcement">HTTPS Enforcement<a class="anchor" href="#https-enforcement">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">CloudFront</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Protocol</span>: <span style="color:#ae81ff">HTTPS only</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">TLS Version</span>: <span style="color:#ae81ff">1.2</span> <span style="color:#ae81ff">minimum (prefer 1.3)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Ciphers</span>: <span style="color:#ae81ff">Strong ciphers only</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">TLS_AES_128_GCM_SHA256</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">TLS_AES_256_GCM_SHA384</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">TLS_CHACHA20_POLY1305_SHA256</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Certificate</span>: <span style="color:#ae81ff">AWS Certificate Manager (ACM)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">API Gateway</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Protocol</span>: <span style="color:#ae81ff">HTTPS only</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">TLS Version</span>: <span style="color:#ae81ff">1.2</span> <span style="color:#ae81ff">minimum</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Certificate</span>: <span style="color:#ae81ff">ACM</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">S3 Pre-signed URLs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Protocol</span>: <span style="color:#ae81ff">HTTPS</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Expiry</span>: <span style="color:#ae81ff">15</span> <span style="color:#ae81ff">minutes</span></span></span></code></pre></div><h3 id="3-secrets-management">3. Secrets Management<a class="anchor" href="#3-secrets-management">#</a></h3>
<h4 id="aws-secrets-manager">AWS Secrets Manager<a class="anchor" href="#aws-secrets-manager">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Secrets Stored</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">bedrock/api-key (if needed)</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">database/credentials (if using RDS - not in MVP)</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">third-party/api-keys (future)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Configuration</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Rotation</span>: <span style="color:#ae81ff">Automatic (30 days)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Encryption</span>: <span style="color:#ae81ff">AWS KMS</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Access</span>: <span style="color:#ae81ff">IAM roles only</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Lambda Access</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Cache secrets in memory (Lambda lifecycle)</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Refresh on rotation</span></span></span></code></pre></div><h4 id="environment-variables">Environment Variables<a class="anchor" href="#environment-variables">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// Lambda environment variables (encrypted)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">DYNAMODB_TABLE</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;smart-cooking-data&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">S3_BUCKET_RECIPES</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;smart-cooking-recipe-images-prod&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">COGNITO_USER_POOL_ID</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;us-east-1_abc123&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">BEDROCK_MODEL_ID</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;anthropic.claude-3-haiku-20240307-v1:0&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Never store in code:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// ‚ùå API keys
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// ‚ùå Database passwords
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// ‚ùå Secret tokens
</span></span></span></code></pre></div><h2 id="iam-identity-and-access-management">IAM (Identity and Access Management)<a class="anchor" href="#iam-identity-and-access-management">#</a></h2>
<h3 id="lambda-execution-roles">Lambda Execution Roles<a class="anchor" href="#lambda-execution-roles">#</a></h3>
<h4 id="base-lambda-role">Base Lambda Role<a class="anchor" href="#base-lambda-role">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Statement&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;logs:CreateLogGroup&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;logs:CreateLogStream&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;logs:PutLogEvents&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:logs:*:*:*&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;xray:PutTraceSegments&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;xray:PutTelemetryRecords&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><h4 id="ai-suggestion-lambda-role">AI Suggestion Lambda Role<a class="anchor" href="#ai-suggestion-lambda-role">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Statement&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;dynamodb:GetItem&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;dynamodb:Query&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;dynamodb:PutItem&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;arn:aws:dynamodb:us-east-1:*:table/smart-cooking-data&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;arn:aws:dynamodb:us-east-1:*:table/smart-cooking-data/index/*&#34;</span>
</span></span><span style="display:flex;"><span>      ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;bedrock:InvokeModel&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:bedrock:us-east-1::foundation-model/anthropic.claude-3-haiku-*&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><h4 id="recipe-crud-lambda-role">Recipe CRUD Lambda Role<a class="anchor" href="#recipe-crud-lambda-role">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Statement&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;dynamodb:GetItem&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;dynamodb:Query&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;dynamodb:PutItem&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;dynamodb:UpdateItem&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;dynamodb:DeleteItem&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:dynamodb:us-east-1:*:table/smart-cooking-data*&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;s3:PutObject&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;s3:GetObject&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;s3:DeleteObject&#34;</span>
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:s3:::smart-cooking-*/*&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><h3 id="s3-bucket-policies">S3 Bucket Policies<a class="anchor" href="#s3-bucket-policies">#</a></h3>
<h4 id="recipe-images-bucket">Recipe Images Bucket<a class="anchor" href="#recipe-images-bucket">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Statement&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Sid&#34;</span>: <span style="color:#e6db74">&#34;DenyUnencryptedUploads&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Deny&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Principal&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: <span style="color:#e6db74">&#34;s3:PutObject&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:s3:::smart-cooking-recipe-images-prod/*&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Condition&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;StringNotEquals&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;s3:x-amz-server-side-encryption&#34;</span>: <span style="color:#e6db74">&#34;AES256&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Sid&#34;</span>: <span style="color:#e6db74">&#34;RequireHTTPS&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Deny&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Principal&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: <span style="color:#e6db74">&#34;*&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:s3:::smart-cooking-recipe-images-prod/*&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Condition&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Bool&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&#34;aws:SecureTransport&#34;</span>: <span style="color:#e6db74">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Sid&#34;</span>: <span style="color:#e6db74">&#34;AllowCloudFrontRead&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Effect&#34;</span>: <span style="color:#e6db74">&#34;Allow&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Principal&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Service&#34;</span>: <span style="color:#e6db74">&#34;cloudfront.amazonaws.com&#34;</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Action&#34;</span>: <span style="color:#e6db74">&#34;s3:GetObject&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;Resource&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:s3:::smart-cooking-recipe-images-prod/*&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><h2 id="security-monitoring--incident-response">Security Monitoring &amp; Incident Response<a class="anchor" href="#security-monitoring--incident-response">#</a></h2>
<h3 id="cloudwatch-alarms">CloudWatch Alarms<a class="anchor" href="#cloudwatch-alarms">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Security Alarms</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">UnauthorizedAPIAttempts</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Metric</span>: <span style="color:#ae81ff">API Gateway 4xx errors</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Threshold</span>: <span style="color:#ae81ff">&gt; 100 in 5 minutes</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Action</span>: <span style="color:#ae81ff">SNS notification</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">SuspiciousActivityDetected</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Metric</span>: <span style="color:#ae81ff">WAF blocked requests</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Threshold</span>: <span style="color:#ae81ff">&gt; 50 from same IP in 5 minutes</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Action</span>: <span style="color:#ae81ff">SNS + Lambda investigation</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">LambdaExecutionErrors</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Metric</span>: <span style="color:#ae81ff">Lambda errors</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Threshold</span>: <span style="color:#ae81ff">&gt; 10 in 5 minutes</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Action</span>: <span style="color:#ae81ff">SNS notification</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">UnusualDataAccess</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Metric</span>: <span style="color:#ae81ff">DynamoDB throttled requests</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Threshold</span>: <span style="color:#ae81ff">&gt; 0</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Action</span>: <span style="color:#ae81ff">SNS notification</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">CostAnomaly</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Metric</span>: <span style="color:#ae81ff">Daily AWS cost</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Threshold</span>: <span style="color:#ae81ff">&gt; $20/day (MVP)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Action</span>: <span style="color:#ae81ff">SNS + Auto-disable non-critical functions</span></span></span></code></pre></div><h3 id="aws-x-ray-tracing">AWS X-Ray Tracing<a class="anchor" href="#aws-x-ray-tracing">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Tracing</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Services</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">API Gateway (100% sampling)</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">Lambda AI Suggestion (100%)</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">Lambda Recipe CRUD (10% sampling)</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">DynamoDB (auto)</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">Bedrock (auto)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Annotations</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">user_id</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">request_id</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">api_endpoint</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">error_type</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Segments Tracked</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">Authentication</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">Authorization</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">Database queries</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">AI API calls</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">S3 operations</span></span></span></code></pre></div><h3 id="logging-strategy">Logging Strategy<a class="anchor" href="#logging-strategy">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">CloudWatch Log Groups</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">/aws/lambda/*</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Retention</span>: <span style="color:#ae81ff">7</span> <span style="color:#ae81ff">days</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Format</span>: <span style="color:#ae81ff">JSON</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Fields</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">timestamp</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">level (INFO/WARN/ERROR)</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">request_id</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">user_id</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">function_name</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">message</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">metadata</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">/aws/apigateway/smart-cooking-api</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Retention</span>: <span style="color:#ae81ff">7</span> <span style="color:#ae81ff">days</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Format</span>: <span style="color:#ae81ff">CLF (Common Log Format)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Include</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">Request/Response bodies (excluding sensitive data)</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">Headers (excluding Authorization)</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">Status codes</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">Latency</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">/aws/waf/smart-cooking</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Retention</span>: <span style="color:#ae81ff">30</span> <span style="color:#ae81ff">days</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">Include</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">Blocked requests</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">Rate limit violations</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">Rule matches</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Sensitive Data Filtering</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Password fields</span>: <span style="color:#ae81ff">Always masked</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">JWT tokens</span>: <span style="color:#ae81ff">Masked</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Email addresses</span>: <span style="color:#ae81ff">Partially masked (u***@example.com)</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Payment info</span>: <span style="color:#ae81ff">Never logged (future)</span></span></span></code></pre></div><h2 id="-vulnerability-management">üîç Vulnerability Management<a class="anchor" href="#-vulnerability-management">#</a></h2>
<h3 id="owasp-top-10-mitigations">OWASP Top 10 Mitigations<a class="anchor" href="#owasp-top-10-mitigations">#</a></h3>
<h4 id="1-injection-sql-nosql-command">1. Injection (SQL, NoSQL, Command)<a class="anchor" href="#1-injection-sql-nosql-command">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Mitigations</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">DynamoDB</span>: <span style="color:#ae81ff">Parameterized queries (SDK handles)</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Input validation</span>: <span style="color:#ae81ff">API Gateway + Lambda</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">WAF</span>: <span style="color:#ae81ff">SQL injection rule set</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Code review</span>: <span style="color:#66d9ef">No</span> <span style="color:#ae81ff">eval(), no dynamic queries</span></span></span></code></pre></div><h4 id="2-broken-authentication">2. Broken Authentication<a class="anchor" href="#2-broken-authentication">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Mitigations</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Cognito User Pool</span>: <span style="color:#ae81ff">Industry-standard auth</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">JWT tokens</span>: <span style="color:#ae81ff">Short-lived (1 hour)</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Refresh tokens</span>: <span style="color:#ae81ff">Secure httpOnly cookies</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">MFA</span>: <span style="color:#ae81ff">Optional (premium feature)</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Password policy</span>: <span style="color:#ae81ff">Strong requirements</span></span></span></code></pre></div><h4 id="3-sensitive-data-exposure">3. Sensitive Data Exposure<a class="anchor" href="#3-sensitive-data-exposure">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Mitigations</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">HTTPS</span>: <span style="color:#ae81ff">Everywhere</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Encryption at rest</span>: <span style="color:#ae81ff">All data (DynamoDB, S3)</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Secrets Manager</span>: <span style="color:#ae81ff">API keys</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#66d9ef">No</span> <span style="color:#ae81ff">sensitive data in logs</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Privacy settings</span>: <span style="color:#ae81ff">User control</span></span></span></code></pre></div><h4 id="4-xml-external-entities-xxe">4. XML External Entities (XXE)<a class="anchor" href="#4-xml-external-entities-xxe">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Mitigations</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Not applicable</span>: <span style="color:#ae81ff">JSON-only API</span></span></span></code></pre></div><h4 id="5-broken-access-control">5. Broken Access Control<a class="anchor" href="#5-broken-access-control">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Mitigations</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">JWT validation</span>: <span style="color:#ae81ff">Every request</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Resource ownership</span>: <span style="color:#ae81ff">Checked in Lambda</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">RBAC</span>: <span style="color:#ae81ff">user/admin roles</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Privacy filtering</span>: <span style="color:#ae81ff">Applied before response</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">API Gateway</span>: <span style="color:#ae81ff">Method-level authorization</span></span></span></code></pre></div><h4 id="6-security-misconfiguration">6. Security Misconfiguration<a class="anchor" href="#6-security-misconfiguration">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Mitigations</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Infrastructure as Code</span>: <span style="color:#ae81ff">Consistent config</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">AWS Config</span>: <span style="color:#ae81ff">Compliance monitoring</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Security Group</span>: <span style="color:#ae81ff">Least privilege</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">S3 Buckets</span>: <span style="color:#ae81ff">Private by default</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Error messages</span>: <span style="color:#66d9ef">No</span> <span style="color:#ae81ff">stack traces in production</span></span></span></code></pre></div><h4 id="7-cross-site-scripting-xss">7. Cross-Site Scripting (XSS)<a class="anchor" href="#7-cross-site-scripting-xss">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Mitigations</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">API</span>: <span style="color:#ae81ff">JSON only (not HTML)</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Frontend</span>: <span style="color:#ae81ff">React auto-escapes</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">CSP headers</span>: <span style="color:#ae81ff">Content Security Policy</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Input validation</span>: <span style="color:#ae81ff">Sanitize user content</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">WAF</span>: <span style="color:#ae81ff">XSS rule set</span></span></span></code></pre></div><h4 id="8-insecure-deserialization">8. Insecure Deserialization<a class="anchor" href="#8-insecure-deserialization">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Mitigations</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">JSON parsing</span>: <span style="color:#ae81ff">Safe (JSON.parse)</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#66d9ef">No</span> <span style="color:#ae81ff">user-controlled deserialization</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Input validation</span>: <span style="color:#ae81ff">Schema validation</span></span></span></code></pre></div><h4 id="9-using-components-with-known-vulnerabilities">9. Using Components with Known Vulnerabilities<a class="anchor" href="#9-using-components-with-known-vulnerabilities">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Mitigations</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Dependabot</span>: <span style="color:#ae81ff">Automated vulnerability scanning</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">npm audit</span>: <span style="color:#ae81ff">Regular checks</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">AWS managed services</span>: <span style="color:#ae81ff">Auto-patched</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Lambda runtime</span>: <span style="color:#ae81ff">Latest Node.js 20 LTS</span></span></span></code></pre></div><h4 id="10-insufficient-logging--monitoring">10. Insufficient Logging &amp; Monitoring<a class="anchor" href="#10-insufficient-logging--monitoring">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Mitigations</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">CloudWatch</span>: <span style="color:#ae81ff">Comprehensive logging</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">X-Ray</span>: <span style="color:#ae81ff">Distributed tracing</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Alarms</span>: <span style="color:#ae81ff">Real-time alerts</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Retention</span>: <span style="color:#ae81ff">7-30</span> <span style="color:#ae81ff">days</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Centralized</span>: <span style="color:#ae81ff">All logs in CloudWatch</span></span></span></code></pre></div><h2 id="api-security-best-practices">API Security Best Practices<a class="anchor" href="#api-security-best-practices">#</a></h2>
<h3 id="request-validation">Request Validation<a class="anchor" href="#request-validation">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// API Gateway Request Validator
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">requestSchema</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;object&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">required</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#39;ingredients&#39;</span>, <span style="color:#e6db74">&#39;recipe_count&#39;</span>],
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">properties</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ingredients</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;array&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">minItems</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">maxItems</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">20</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">items</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;string&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">minLength</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">maxLength</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">recipe_count</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;integer&#39;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">minimum</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">maximum</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Lambda validation
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">validateInput</span>(<span style="color:#a6e22e">body</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Sanitize strings
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sanitized</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">ingredients</span>.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">ing</span> =&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ing</span>.<span style="color:#a6e22e">trim</span>().<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/[&lt;&gt;]/g</span>, <span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Validate count based on user tier
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">userTier</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;free&#39;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">recipe_count</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;Free tier limited to 1 recipe&#39;</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">sanitized</span>;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><h3 id="cors-configuration">CORS Configuration<a class="anchor" href="#cors-configuration">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">API Gateway CORS</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Access-Control-Allow-Origin</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">https://smartcooking.app</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">http://localhost:3000 (development)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Access-Control-Allow-Methods</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">GET, POST, PUT, DELETE, OPTIONS</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Access-Control-Allow-Headers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">Content-Type</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">Authorization</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">X-Request-ID</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Access-Control-Max-Age</span>: <span style="color:#ae81ff">3600</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">Access-Control-Allow-Credentials</span>: <span style="color:#66d9ef">true</span></span></span></code></pre></div><h3 id="security-headers">Security Headers<a class="anchor" href="#security-headers">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// Lambda response headers
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">securityHeaders</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;Strict-Transport-Security&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;max-age=31536000; includeSubDomains&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;X-Content-Type-Options&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;nosniff&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;X-Frame-Options&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;DENY&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;X-XSS-Protection&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;1; mode=block&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;Content-Security-Policy&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;default-src &#39;self&#39;; img-src &#39;self&#39; https://s3.amazonaws.com; script-src &#39;self&#39;&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;Referrer-Policy&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;strict-origin-when-cross-origin&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;Permissions-Policy&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;geolocation=(), microphone=(), camera=()&#39;</span>
</span></span><span style="display:flex;"><span>};</span></span></code></pre></div><h2 id="privacy--data-protection">Privacy &amp; Data Protection<a class="anchor" href="#privacy--data-protection">#</a></h2>
<h3 id="gdpr-compliance">GDPR Compliance<a class="anchor" href="#gdpr-compliance">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">Data Subject Rights</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">1. Right to Access</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Endpoint</span>: <span style="color:#ae81ff">GET /user/data-export</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Format</span>: <span style="color:#ae81ff">JSON</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Includes</span>: <span style="color:#ae81ff">Profile, recipes, history, posts</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">2. Right to Deletion</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Endpoint</span>: <span style="color:#ae81ff">DELETE /user/account</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Process</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">Delete user data from DynamoDB</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">Delete S3 objects</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">Anonymize logs (keep for 7 days)</span>
</span></span><span style="display:flex;"><span>        - <span style="color:#ae81ff">Delete Cognito user</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">3. Right to Rectification</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Endpoint</span>: <span style="color:#ae81ff">PUT /user/profile</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">User can update any personal data</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">4. Right to Portability</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Endpoint</span>: <span style="color:#ae81ff">GET /user/data-export</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Format</span>: <span style="color:#ae81ff">JSON (machine-readable)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">5. Right to Object</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Endpoint</span>: <span style="color:#ae81ff">PUT /user/privacy</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ae81ff">User can restrict data usage</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">6. Right to be Informed</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Privacy Policy</span>: <span style="color:#ae81ff">Clear explanation</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Consent</span>: <span style="color:#ae81ff">Explicit opt-in</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">Notifications</span>: <span style="color:#ae81ff">Data breach within 72 hours</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Data Minimization</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">Collect only necessary data</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">AI uses</span>: <span style="color:#ae81ff">age range (not exact birthdate)</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Location</span>: <span style="color:#ae81ff">Country only (not city/address)</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#66d9ef">No</span> <span style="color:#ae81ff">tracking pixels (MVP)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">Data Retention</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">User data</span>: <span style="color:#ae81ff">Until account deletion</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Logs</span>: <span style="color:#ae81ff">7-30</span> <span style="color:#ae81ff">days</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">Backups</span>: <span style="color:#ae81ff">35</span> <span style="color:#ae81ff">days (PITR)</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">AI suggestions</span>: <span style="color:#ae81ff">90</span> <span style="color:#ae81ff">days (optional)</span></span></span></code></pre></div><h3 id="ai-privacy-policy">AI Privacy Policy<a class="anchor" href="#ai-privacy-policy">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span><span style="color:#75715e">## AI Agent Data Usage
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>The Smart Cooking AI uses the following data to personalize recipe suggestions:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">**Data Used:**</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> Age range (derived from birth year) - for nutritional recommendations
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> Gender - for portion size recommendations
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> Country - for regional cuisine preferences
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> Cooking preferences (stir-fry, steam, soup, etc.)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> Favorite cuisines (Vietnamese, Italian, etc.)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> Allergies - <span style="font-weight:bold">**CRITICAL**</span> for food safety
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">**Data NOT Used:**</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> Full name
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> Email address
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> Exact location
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> Payment information
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> Browsing history
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">**Purpose:**</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> Personalize recipe suggestions only
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> No advertising or marketing
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> No third-party sharing
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> No profiling beyond cooking preferences
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">**User Control:**</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> You can update preferences anytime
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> You can delete your data anytime
</span></span><span style="display:flex;"><span>- AI suggestions are optional</span></span></code></pre></div><h2 id="related-documents">Related Documents<a class="anchor" href="#related-documents">#</a></h2>
<ul>
<li><a href="10-architecture.md">10 - Architecture</a></li>
<li><a href="12-api-spec.md">12 - API Spec</a></li>
<li><a href="14-ai-agent.md">14 - AI Agent</a></li>
<li><a href="41-privacy.md">41 - Privacy</a></li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">

<div>

</div>

<div>

</div>

</div>





  
  
  
  <div class="flex flex-wrap justify-between">
    <span>
    
      <a href="/docs/dlc/12-api-spec/" class="flex align-center">
        <img src="/icons/backward.svg" class="book-icon" alt="Previous" title="12 - API Specification" />
        <span>12 - API Specification</span>
      </a>
    
    </span>
    <span>
    
      <a href="/docs/dlc/14-ai-agent/" class="flex align-center">
        <span>14 - AI Agent Design</span>
        <img src="/icons/forward.svg" class="book-icon" alt="Next" title="14 - AI Agent Design" />
      </a>
    
    </span>
  </div>
  




  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
  
  <div class="book-comments">

</div>
  
 
        
        

 
      </footer>

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    

<aside class="book-toc">
  <div class="book-toc-content">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#security-overview">Security Overview</a>
      <ul>
        <li><a href="#security-principles">Security Principles</a></li>
        <li><a href="#compliance--standards">Compliance &amp; Standards</a></li>
      </ul>
    </li>
    <li><a href="#authentication--authorization">Authentication &amp; Authorization</a>
      <ul>
        <li><a href="#1-amazon-cognito-user-pool">1. Amazon Cognito User Pool</a></li>
        <li><a href="#2-api-gateway-authorization">2. API Gateway Authorization</a></li>
        <li><a href="#3-lambda-authorization">3. Lambda Authorization</a></li>
      </ul>
    </li>
    <li><a href="#aws-waf-web-application-firewall">AWS WAF (Web Application Firewall)</a>
      <ul>
        <li><a href="#waf-rules-configuration">WAF Rules Configuration</a></li>
        <li><a href="#rate-limiting-strategy">Rate Limiting Strategy</a></li>
      </ul>
    </li>
    <li><a href="#data-encryption">Data Encryption</a>
      <ul>
        <li><a href="#1-encryption-at-rest">1. Encryption at Rest</a></li>
        <li><a href="#2-encryption-in-transit">2. Encryption in Transit</a></li>
        <li><a href="#3-secrets-management">3. Secrets Management</a></li>
      </ul>
    </li>
    <li><a href="#iam-identity-and-access-management">IAM (Identity and Access Management)</a>
      <ul>
        <li><a href="#lambda-execution-roles">Lambda Execution Roles</a></li>
        <li><a href="#s3-bucket-policies">S3 Bucket Policies</a></li>
      </ul>
    </li>
    <li><a href="#security-monitoring--incident-response">Security Monitoring &amp; Incident Response</a>
      <ul>
        <li><a href="#cloudwatch-alarms">CloudWatch Alarms</a></li>
        <li><a href="#aws-x-ray-tracing">AWS X-Ray Tracing</a></li>
        <li><a href="#logging-strategy">Logging Strategy</a></li>
      </ul>
    </li>
    <li><a href="#-vulnerability-management">üîç Vulnerability Management</a>
      <ul>
        <li><a href="#owasp-top-10-mitigations">OWASP Top 10 Mitigations</a></li>
      </ul>
    </li>
    <li><a href="#api-security-best-practices">API Security Best Practices</a>
      <ul>
        <li><a href="#request-validation">Request Validation</a></li>
        <li><a href="#cors-configuration">CORS Configuration</a></li>
        <li><a href="#security-headers">Security Headers</a></li>
      </ul>
    </li>
    <li><a href="#privacy--data-protection">Privacy &amp; Data Protection</a>
      <ul>
        <li><a href="#gdpr-compliance">GDPR Compliance</a></li>
        <li><a href="#ai-privacy-policy">AI Privacy Policy</a></li>
      </ul>
    </li>
    <li><a href="#related-documents">Related Documents</a></li>
  </ul>
</nav>



  </div>
</aside>

 
  </main>

  
</body>
</html>


















